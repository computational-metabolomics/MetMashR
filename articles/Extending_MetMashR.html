<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MetMashR">
<title>Extending MetMashR • MetMashR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extending MetMashR">
<meta property="og:description" content="MetMashR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-standard navbar-expand-lg bg-primary" data-bs-theme="standard"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MetMashR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/using_MetMashR.html">Using MetMashR</a>
    <a class="dropdown-item" href="../articles/Extending_MetMashR.html">Extending MetMashR</a>
    <a class="dropdown-item" href="../articles/annotate_mixtures.html">Annotating mixtures of standards</a>
    <a class="dropdown-item" href="../articles/exploring_mtox.html">Exploring the MTox700+ database</a>
    <a class="dropdown-item" href="../articles/daphnia_example.html">Processing Annotations for LCMS of Daphnia samples</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/computational-metabolomics/MetMashR" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.birmingham.ac.uk/research/activity/phenome-centre/index.aspx" aria-label="Phenome Centre Birmingham">
    <span class="fa fa-flask"></span>
     
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--">
    <span class="fa fa-music"></span>
     
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--">
    <a class="external-link dropdown-item" href="https://www.bioconductor.org/packages/release/bioc/html/MetMashR.html">MetMashR</a>
    <a class="external-link dropdown-item" href="https://www.bioconductor.org/packages/release/bioc/html/struct.html">struct</a>
    <a class="external-link dropdown-item" href="https://www.bioconductor.org/packages/release/bioc/html/structToolbox.html">structToolbox</a>
    <a class="external-link dropdown-item" href="https://www.bioconductor.org/packages/release/bioc/html/metabolomicsWorkbenchR.html">metabolmicsWorkbenchR</a>
    <a class="external-link dropdown-item" href="https://www.bioconductor.org/packages/release/bioc/html/pmp.html">pmp</a>
  </div>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Extending MetMashR</h1>
                        <h4 data-toc-skip class="author">Gavin Rhys
Lloyd</h4>
            
            <h4 data-toc-skip class="date">2024-03-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/computational-metabolomics/MetMashR/blob/HEAD/vignettes/Extending_MetMashR.Rmd" class="external-link"><code>vignettes/Extending_MetMashR.Rmd</code></a></small>
      <div class="d-none name"><code>Extending_MetMashR.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>There is a number software solutions available to annotate an LCMS
metabolomics datasets. We have only included a small number
<code>annotation_sources</code> in <code>MetMashR</code> as they are the
ones we use the most.</p>
<p>In this document we describe how to extend the provided templates to
include new sources bespoke to your requirements.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>The latest versions of <em><a href="https://bioconductor.org/packages/3.19/struct" class="external-link">struct</a></em> and
<code>MetMashR</code> that are compatible with your current R version
can be installed using BiocManager.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install BiocManager if not present</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># install MetMashR and dependencies</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"MetMashR"</span><span class="op">)</span></span></code></pre></div>
<p>Once installed you can activate the packages in the usual way:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">struct</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://computational-metabolomics.github.io/MetMashR/">MetMashR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">metabolomicsWorkbenchR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-study">Example study<a class="anchor" aria-label="anchor" href="#example-study"></a>
</h2>
<p>In this example we are going to import some annotations from a study
on Metabolomics Workbench and build a workflow to clean up the table and
search for PubChem CIDs so that we can present some images of some of
the annotated metabolites for the study.</p>
<p>First, we need to import the table of annotations from Metabolomics
Workbench. For this we make use of the
<code>metabolomicsWorkbenchR</code> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get annotations</span></span>
<span><span class="va">AN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metabolomicsWorkbenchR/man/do_query.html" class="external-link">do_query</a></span><span class="op">(</span></span>
<span>    context <span class="op">=</span> <span class="st">"study"</span>,</span>
<span>    input_item <span class="op">=</span> <span class="st">"analysis_id"</span>,</span>
<span>    input_value <span class="op">=</span> <span class="st">"AN000465"</span>,</span>
<span>    output_item <span class="op">=</span> <span class="st">"metabolites"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The imported table has 747 rows and 8 columns. For brevity in this
vignette we have cached the first 10 rows and stored them in the
package.</p>
<p>We can convert the imported table into an
<code>annotation_table</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotation_table.html">annotation_table</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AN</span>, id_column <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>All <code>annotation_table</code> objects must have an id for each
row in the table. This is so that later, when examining the outputs of
workflow steps, you can easily trace an annotation through the workflow.
The default <code>id_column = NULL</code> will create a new column
‘.MetMashR_id’ containing the row index as an identifier unless provided
with an alternative column name, which should be the name of a column
already in the table.</p>
<p>Two steps needed to clean up this table are not provided by
<code>MetMashR</code>:</p>
<ul>
<li>removal of empty columns</li>
<li>removal of suffix from duplicate molecule names</li>
</ul>
<p>We will implement these steps here as an example of how to add new
workflow steps using the <em><a href="https://bioconductor.org/packages/3.19/struct" class="external-link">struct</a></em>
package template system. We will also implement an new
<code>annotation_source</code> to import the data from Metabolomics
Workbench as part of the workflow.</p>
</div>
<div class="section level2">
<h2 id="annotation-sources">Annotation Sources<a class="anchor" aria-label="anchor" href="#annotation-sources"></a>
</h2>
<p>Annotation sources are the mechanism used by <code>MetMashR</code> to
get tables of annotation data into R and into a well-defined format.
Each extension of the base <code>annotation_source</code> template
provides methods to import the raw annotation table and convert it into
a type of <code>annotation_table</code> suitable for the input data. For
example, the <code>cd_source</code> defines methods to import annotation
data from Compound Discoverer’s Excel format and convert it into a
<code>lcms_table</code> object.</p>
</div>
<div class="section level2">
<h2 id="adding-new-annotation-sources">Adding new annotation sources<a class="anchor" aria-label="anchor" href="#adding-new-annotation-sources"></a>
</h2>
<p>If we plan to import annotation data from Metabolomics Workbench a
lot we could consider implementing a new <code>annotation_source</code>
that would import the annotations as part of a workflow model
sequence.</p>
<p>We will do this now as an example of implementing a new
<code>annotation_source</code>.</p>
<p>All <code>annotation_source</code> objects use the <code>model</code>
template from the struct package, so we could create the definition of a
source on-the-fly. However, annotation_sources are likely to be used
multiple times to read in data from the same source, so instead we
define the new source in a more permanent way, by using code that can be
included in a script to be sourced, or in a new R package.</p>
<p>There are three key components to an annotation source object, or
indeed any struct model object:</p>
<ol style="list-style-type: decimal">
<li>A definition of the object which defines what the input and output
parameters will be.</li>
<li>A function to create an instance of the object and populate initial
values for input parameters.</li>
<li>A <code>model_apply</code> method. For annotation sources this
method will read in data from the source file and parse it into an
<code>annotation_table</code>.</li>
</ol>
<p>We will implement each of these steps now.</p>
<div class="section level3">
<h3 id="the-class-definition">The class definition<a class="anchor" aria-label="anchor" href="#the-class-definition"></a>
</h3>
<p>In this example there are no input and output slots, but they could
be defined using the <code>slots</code> parameter, and then
differentiated by name using <code>.params</code> and
<code>.outputs</code> in the prototype.</p>
<p>We have defined <code>libraries</code> in the prototype. This is a
list of R package names that are needed to use this object in addition
to the depends/imports of <code>MetMashR</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.mwb_source</span> <span class="op">&lt;-</span> <span class="kw">setClass</span><span class="op">(</span></span>
<span>    <span class="st">"mwb_source"</span>,</span>
<span>    contains <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"annotation_database"</span><span class="op">)</span>,</span>
<span>    prototype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Import from Metabolomics Workbench"</span>,</span>
<span>        libraries <span class="op">=</span> <span class="st">"metabolomicsWorkbenchR"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-calling-function">The calling function<a class="anchor" aria-label="anchor" href="#the-calling-function"></a>
</h3>
<p>The calling function is a small function that creates a new instance
of the source object using <code>new_struct</code> and provides a
mechanism to initialise values based on input parameters.</p>
<p>The use of ellipsis <code>...</code> allows us to pass additional
values to the base <code>struct</code> object like name and description
without including them in the function definition, in case we want to
override the values defined in the prototype of the class definition in
the previous section.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mwb_source</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># new object</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/struct/man/new_struct.html" class="external-link">new_struct</a></span><span class="op">(</span></span>
<span>        <span class="st">"mwb_source"</span>,</span>
<span>        <span class="va">...</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-import-method">The import method<a class="anchor" aria-label="anchor" href="#the-import-method"></a>
</h3>
<p>Like all model objects, the workhorse method for annotation sources
is <code>method_apply</code>. For annotation sources this method is used
to import and parse the source files into an
<code>annotation_table</code>.</p>
<p>Here we use <code>setMethod</code> to define the method for the new
source.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">setMethod</span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="st">"read_database"</span>,</span>
<span>    signature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mwb_source"</span><span class="op">)</span>,</span>
<span>    definition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co">## get annotations using metabolomicsWorkbenchR</span></span>
<span>        <span class="co"># AN = do_query(</span></span>
<span>        <span class="co">#    context = "study",</span></span>
<span>        <span class="co">#    input_item = "analysis_id",</span></span>
<span>        <span class="co">#    input_value = M$analysis_id,</span></span>
<span>        <span class="co">#    output_item = "metabolites")</span></span>
<span></span>
<span>        <span class="co">## for vignette use locally cached subset</span></span>
<span>        <span class="va">AN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/AN000465_subset.rds"</span>, package <span class="op">=</span> <span class="st">"MetMashR"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">AN</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note how we pass <code>M$analysis</code> id to the
<code>do_query</code> function so that we can import annotations from
any Metabolomics Workbench study when using our new source object.</p>
</div>
<div class="section level3">
<h3 id="using-the-new-source">Using the new source<a class="anchor" aria-label="anchor" href="#using-the-new-source"></a>
</h3>
<p>The new <code>mwb_source</code> and <code>method_apply</code> method
are ready to use. To import the table we can use the
<code>import_source</code> method:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initialise source</span></span>
<span><span class="va">SRC</span> <span class="op">&lt;-</span> <span class="fu">mwb_source</span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="st">"AN000465"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># import</span></span>
<span><span class="va">AT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_source.html">read_source</a></span><span class="op">(</span><span class="va">SRC</span><span class="op">)</span></span></code></pre></div>
<p>Variable <code>AT</code> is the imported and cleaned
<code>annotation_database</code> from Metabolomics Workbench and can be
used as input to <code>model_apply</code> for other models and sequence,
e.g. to look up PubChem Ids etc.</p>
</div>
</div>
<div class="section level2">
<h2 id="adding-annotation-workflow-steps">Adding annotation workflow steps<a class="anchor" aria-label="anchor" href="#adding-annotation-workflow-steps"></a>
</h2>
<p><code>MetMashR</code> workflow steps use the <code>model</code>
template from the <em><a href="https://bioconductor.org/packages/3.19/struct" class="external-link">struct</a></em>
package. Although originally intended for statistical methods, the
<code>model</code> template is a flexible way to implement many
different kinds of workflow step.</p>
<p>The <em><a href="https://bioconductor.org/packages/3.19/struct" class="external-link">struct</a></em>
package provides convenience functions for “on-the-fly” implementation
of new model objects. Here will will use the convenience functions to
implement the first new model. Examples of this are also included in the
<em><a href="https://bioconductor.org/packages/3.19/struct" class="external-link">struct</a></em>
package vignette.</p>
<div class="section level3">
<h3 id="empty-column-removal">Empty column removal<a class="anchor" aria-label="anchor" href="#empty-column-removal"></a>
</h3>
<p>To define a new <code>model</code> object we can use the
<code>set_struct_obj</code> function. The new object is fairly simple in
that no input parameters are required. The only output slot will contain
the <code>annotation_table</code> after we have removed the empty
columns.</p>
<p>For the <code>prototype</code> input we provide a name and a
description for our new model. This is good practice as our intentions
for this model are explicitly stated and stay with the model wherever we
use it, helping to ensure transparency, reproducibility etc. We also
defined the default output of the model by providing
<code>predicted</code> in the <code>prototype</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/struct/man/set_struct_obj.html" class="external-link">set_struct_obj</a></span><span class="op">(</span></span>
<span>    class_name <span class="op">=</span> <span class="st">"drop_empty_columns"</span>,</span>
<span>    struct_obj <span class="op">=</span> <span class="st">"model"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>updated <span class="op">=</span> <span class="st">"annotation_source"</span><span class="op">)</span>,</span>
<span>    private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    prototype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Drop empty columns"</span>,</span>
<span>        description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>            <span class="st">"A workflow step that removes columns from an annotation table "</span>,</span>
<span>            <span class="st">"where all rows are NA."</span></span>
<span>        <span class="op">)</span>,</span>
<span>        predicted <span class="op">=</span> <span class="st">"updated"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can now create an instance of our new model, and use the
<code>show</code> method to display information about it.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu">drop_empty_columns</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span>
<span><span class="co">#&gt; A "drop_empty_columns" object</span></span>
<span><span class="co">#&gt; -----------------------------</span></span>
<span><span class="co">#&gt; name:          Drop empty columns</span></span>
<span><span class="co">#&gt; description:   A workflow step that removes columns from an annotation table where all rows are NA.</span></span>
<span><span class="co">#&gt; outputs:       updated </span></span>
<span><span class="co">#&gt; predicted:     updated</span></span>
<span><span class="co">#&gt; seq_in:        data</span></span></code></pre></div>
<p>Before we can use our new model we need to implement the
<code>model_apply</code> method for it. This is the function that
actually does all the work. In this case it will search for columns of
missing values and then remove them from the
<code>annotation_table</code>. To define this method we use the
<code>set_obj_method</code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/struct/man/set_obj_method.html" class="external-link">set_obj_method</a></span><span class="op">(</span></span>
<span>    class_name <span class="op">=</span> <span class="st">"drop_empty_columns"</span>,</span>
<span>    method_name <span class="op">=</span> <span class="st">"model_apply"</span>,</span>
<span>    signature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"drop_empty_columns"</span>, <span class="st">"annotation_source"</span><span class="op">)</span>,</span>
<span>    definition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">M</span>, <span class="va">D</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># search for columns of NA</span></span>
<span>        <span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span> <span class="co"># for each column</span></span>
<span>            <span class="va">D</span><span class="op">$</span><span class="va">data</span>, <span class="co"># in the annotation table</span></span>
<span>            <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="co"># return TRUE if all rows are NA</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="co"># get index of columns with all rows NA</span></span>
<span>        <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># if any found, remove from annotation table</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">idx</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">D</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="va">idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="co"># update model object</span></span>
<span>        <span class="va">M</span><span class="op">$</span><span class="va">updated</span> <span class="op">&lt;-</span> <span class="va">D</span></span>
<span></span>
<span>        <span class="co"># return object</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that in the <code>signature</code> we specify that the second
input is an <code>annotation_table</code>.</p>
<p>The new model is ready to use. We can test it using the
<code>model_apply</code> method, and check that some columns have been
removed.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/struct/man/model_apply.html" class="external-link">model_apply</a></span><span class="op">(</span><span class="va">M</span>, <span class="va">AT</span><span class="op">)</span></span></code></pre></div>
<p>The number of columns before was:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">AT</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span></code></pre></div>
<p>The number of columns afterwards is:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">M</span><span class="op">$</span><span class="va">updated</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="suffix-removal">Suffix removal<a class="anchor" aria-label="anchor" href="#suffix-removal"></a>
</h3>
<p>The second model removes the suffix from the molecule names. The is
necessary if we want to use the molecule names to e.g search for PubChem
identifiers using the REST API; we wont get a match if the suffix is
part of the molecule name.</p>
<p>As we did for <code>drop_empty_columns</code> we use the
<code>set_struct_obj</code> and <code>set_obj_method</code> function to
create our new workflow step.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define new model object</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/struct/man/set_struct_obj.html" class="external-link">set_struct_obj</a></span><span class="op">(</span></span>
<span>    class_name <span class="op">=</span> <span class="st">"remove_suffix"</span>,</span>
<span>    struct_obj <span class="op">=</span> <span class="st">"model"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>clean <span class="op">=</span> <span class="st">"logical"</span>, column_name <span class="op">=</span> <span class="st">"character"</span><span class="op">)</span>,</span>
<span>    outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>updated <span class="op">=</span> <span class="st">"annotation_source"</span><span class="op">)</span>,</span>
<span>    prototype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"Remove suffix"</span>,</span>
<span>        description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>            <span class="st">"A workflow step that removes suffixes from molecule names by "</span>,</span>
<span>            <span class="st">"splitting a string at the last underscore an retaining the part"</span>,</span>
<span>            <span class="st">"of the string before the underscore."</span></span>
<span>        <span class="op">)</span>,</span>
<span>        predicted <span class="op">=</span> <span class="st">"updated"</span>,</span>
<span>        clean <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        column_name <span class="op">=</span> <span class="st">"V1"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define method for new object</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/struct/man/set_obj_method.html" class="external-link">set_obj_method</a></span><span class="op">(</span></span>
<span>    class_name <span class="op">=</span> <span class="st">"remove_suffix"</span>,</span>
<span>    method_name <span class="op">=</span> <span class="st">"model_apply"</span>,</span>
<span>    signature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"remove_suffix"</span>, <span class="st">"annotation_source"</span><span class="op">)</span>,</span>
<span>    definition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">M</span>, <span class="va">D</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># get list of molecule names</span></span>
<span>        <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">M</span><span class="op">$</span><span class="va">column_name</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>        <span class="co"># split string at last underscore</span></span>
<span>        <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"_(?!.*_)"</span>, perl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># get left hand side</span></span>
<span>        <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">"["</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co"># if clean replace existing column, otherwise new column</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">M</span><span class="op">$</span><span class="va">clean</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">D</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">M</span><span class="op">$</span><span class="va">column_name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="va">D</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">name.fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="co"># update model object</span></span>
<span>        <span class="va">M</span><span class="op">$</span><span class="va">updated</span> <span class="op">&lt;-</span> <span class="va">D</span></span>
<span></span>
<span>        <span class="co"># return object</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For this model we included two input parameters and provided default
values in the <code>prototype</code>:</p>
<ul>
<li>column_name: the name of the column in the annotation table
containing molecule names</li>
<li>clean: a flag that will replace the old column if TRUE or add a new
column if FALSE</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="metabolite-mashing">Metabolite mashing<a class="anchor" aria-label="anchor" href="#metabolite-mashing"></a>
</h2>
<p>Now that we have defined our new workflow steps we can use them in a
<code>model_seq</code> (workflow), alongside other existing steps to
mash the annotations with other tables containing identifiers and
additional information.</p>
<p>In this case we do the following:</p>
<ol style="list-style-type: decimal">
<li>import the annotations from Metabolomics Workbench</li>
<li>remove empty columns</li>
<li>remove suffixes from molecule names</li>
<li>search the Metabolomics Workbench refmet database for
identifiers</li>
<li>use the PubChem REST API so search for compound CIDs</li>
<li>combine the CID columns from refmet and pubchem into a single
column, giving priority to refmet, to obtain a single column of
identifiers we have confidence in for as many metabolites as
possible</li>
<li>use the PubChem REST API to obtain SMILES for each metabolite</li>
</ol>
<p>For clarity in the workflow we import the refmet database before
using it in the workflow instead of importing it in-line. We also import
some cached REST API responses so that we dont overburden the service
when generating the vignette.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># refmet</span></span>
<span><span class="va">refmet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mwb_refmet_database.html">mwb_refmet_database</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># pubchem caches</span></span>
<span><span class="va">pubchem_cid_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rds_database.html">rds_database</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"cached/pubchem_cid_cache.rds"</span>,</span>
<span>        package <span class="op">=</span> <span class="st">"MetMashR"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pubchem_smile_cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rds_database.html">rds_database</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"cached/pubchem_smiles_cache.rds"</span>,</span>
<span>        package <span class="op">=</span> <span class="st">"MetMashR"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In practice it is better to create your own cache using
e.g. <code>rds_database</code>, <code>sql_database</code> or other
<code>struct_database</code> objects with write access. See the vignette
[TODO] for more details.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare sequence</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_source.html">import_source</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">drop_empty_columns</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">remove_suffix</span><span class="op">(</span></span>
<span>        clean <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        column_name <span class="op">=</span> <span class="st">"metabolite_name"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/database_lookup.html">database_lookup</a></span><span class="op">(</span></span>
<span>        query_column <span class="op">=</span> <span class="st">"refmet_name"</span>,</span>
<span>        database_column <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>        database <span class="op">=</span> <span class="va">refmet</span>,</span>
<span>        suffix <span class="op">=</span> <span class="st">"_mwb"</span>,</span>
<span>        include <span class="op">=</span> <span class="st">"pubchem_cid"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/pubchem_compound_lookup.html">pubchem_compound_lookup</a></span><span class="op">(</span></span>
<span>        query_column <span class="op">=</span> <span class="st">"metabolite_name"</span>,</span>
<span>        search_by <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>        suffix <span class="op">=</span> <span class="st">"_pc"</span>,</span>
<span>        output <span class="op">=</span> <span class="st">"cids"</span>,</span>
<span>        records <span class="op">=</span> <span class="st">"best"</span>,</span>
<span>        delay <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>        cache <span class="op">=</span> <span class="va">pubchem_cid_cache</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/prioritise_columns.html">prioritise_columns</a></span><span class="op">(</span></span>
<span>        column_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pubchem_cid_mwb"</span>, <span class="st">"CID_pc"</span><span class="op">)</span>,</span>
<span>        output_name <span class="op">=</span> <span class="st">"pubchem_cid"</span>,</span>
<span>        source_name <span class="op">=</span> <span class="st">"pubchem_cid_source"</span>,</span>
<span>        source_tags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mwb"</span>, <span class="st">"pc"</span><span class="op">)</span>,</span>
<span>        clean <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/pubchem_property_lookup.html">pubchem_property_lookup</a></span><span class="op">(</span></span>
<span>        query_column <span class="op">=</span> <span class="st">"pubchem_cid"</span>,</span>
<span>        search_by <span class="op">=</span> <span class="st">"cid"</span>,</span>
<span>        suffix <span class="op">=</span> <span class="st">""</span>,</span>
<span>        property <span class="op">=</span> <span class="st">"CanonicalSMILES"</span>,</span>
<span>        delay <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>        cache <span class="op">=</span> <span class="va">pubchem_smile_cache</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># apply sequence</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/struct/man/model_apply.html" class="external-link">model_apply</a></span><span class="op">(</span><span class="va">M</span>, <span class="fu">mwb_source</span><span class="op">(</span>source <span class="op">=</span> <span class="st">"AN000465"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that because the first step in the workflow is to import data
from Metabolomics Workbench, we only need to provide an empty
annotation_table as input to <code>model_apply</code> as it will be
updated when we run the workflow.</p>
<p>Once the table has been processed by our workflow we then use
OpenBabel to generate images of the molecular structures from
SMILES.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare chart</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openbabel_structure.html">openbabel_structure</a></span><span class="op">(</span></span>
<span>    smiles_column <span class="op">=</span> <span class="st">"CanonicalSMILES"</span>,</span>
<span>    row_index <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    scale_to_fit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    view_port <span class="op">=</span> <span class="fl">400</span>,</span>
<span>    image_size <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop over some records and plot some of the molecules</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">C</span><span class="op">$</span><span class="va">row_index</span> <span class="op">&lt;-</span> <span class="va">k</span></span>
<span>    <span class="va">G</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/struct/man/chart_plot.html" class="external-link">chart_plot</a></span><span class="op">(</span><span class="va">C</span>, <span class="fu"><a href="https://rdrr.io/pkg/struct/man/predicted.html" class="external-link">predicted</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">G</span>, nrow <span class="op">=</span> <span class="fl">1</span>, labels <span class="op">=</span> <span class="st">"AUTO"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Extending_MetMashR_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Extending the templates provided by <code>struct</code> to implement
workflow steps for metabolite mashing is straight forward using either
the provided on-the-fly functions or scripting more permanent solutions.
All objects that use the templates will be compatible with other
workflow objects provided you follow the templates. As well as new
workflow steps MetMashR can also be extended to include additional
annotation sources.</p>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R Under development (unstable) (2024-03-13 r86113)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] ggplot2_3.5.0                 metabolomicsWorkbenchR_1.13.0</span></span>
<span><span class="co">#&gt; [3] MetMashR_0.99.0               struct_1.15.4                </span></span>
<span><span class="co">#&gt; [5] BiocStyle_2.31.0             </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] tidyselect_1.2.1            farver_2.1.1               </span></span>
<span><span class="co">#&gt;  [3] dplyr_1.1.4                 blob_1.2.4                 </span></span>
<span><span class="co">#&gt;  [5] filelock_1.0.3              bitops_1.0-7               </span></span>
<span><span class="co">#&gt;  [7] fastmap_1.1.1               RCurl_1.98-1.14            </span></span>
<span><span class="co">#&gt;  [9] BiocFileCache_2.11.1        digest_0.6.35              </span></span>
<span><span class="co">#&gt; [11] lifecycle_1.0.4             rsvg_2.6.0                 </span></span>
<span><span class="co">#&gt; [13] RSQLite_2.3.5               magrittr_2.0.3             </span></span>
<span><span class="co">#&gt; [15] compiler_4.4.0              rlang_1.1.3                </span></span>
<span><span class="co">#&gt; [17] sass_0.4.9                  tools_4.4.0                </span></span>
<span><span class="co">#&gt; [19] utf8_1.2.4                  yaml_2.3.8                 </span></span>
<span><span class="co">#&gt; [21] data.table_1.15.2           knitr_1.45                 </span></span>
<span><span class="co">#&gt; [23] labeling_0.4.3              S4Arrays_1.3.6             </span></span>
<span><span class="co">#&gt; [25] htmlwidgets_1.6.4           ontologyIndex_2.12         </span></span>
<span><span class="co">#&gt; [27] bit_4.0.5                   curl_5.2.1                 </span></span>
<span><span class="co">#&gt; [29] DelayedArray_0.29.9         plyr_1.8.9                 </span></span>
<span><span class="co">#&gt; [31] abind_1.4-5                 withr_3.0.0                </span></span>
<span><span class="co">#&gt; [33] purrr_1.0.2                 BiocGenerics_0.49.1        </span></span>
<span><span class="co">#&gt; [35] desc_1.4.3                  grid_4.4.0                 </span></span>
<span><span class="co">#&gt; [37] stats4_4.4.0                fansi_1.0.6                </span></span>
<span><span class="co">#&gt; [39] colorspace_2.1-0            scales_1.3.0               </span></span>
<span><span class="co">#&gt; [41] MultiAssayExperiment_1.29.1 SummarizedExperiment_1.33.3</span></span>
<span><span class="co">#&gt; [43] cli_3.6.2                   rmarkdown_2.26             </span></span>
<span><span class="co">#&gt; [45] crayon_1.5.2                ragg_1.3.0                 </span></span>
<span><span class="co">#&gt; [47] generics_0.1.3              httr_1.4.7                 </span></span>
<span><span class="co">#&gt; [49] DBI_1.2.2                   cachem_1.0.8               </span></span>
<span><span class="co">#&gt; [51] stringr_1.5.1               zlibbioc_1.49.3            </span></span>
<span><span class="co">#&gt; [53] ggthemes_5.1.0              BiocManager_1.30.22        </span></span>
<span><span class="co">#&gt; [55] XVector_0.43.1              matrixStats_1.2.0          </span></span>
<span><span class="co">#&gt; [57] vctrs_0.6.5                 Matrix_1.6-5               </span></span>
<span><span class="co">#&gt; [59] jsonlite_1.8.8              bookdown_0.38              </span></span>
<span><span class="co">#&gt; [61] IRanges_2.37.1              S4Vectors_0.41.5           </span></span>
<span><span class="co">#&gt; [63] bit64_4.0.5                 magick_2.8.3               </span></span>
<span><span class="co">#&gt; [65] systemfonts_1.0.6           jquerylib_0.1.4            </span></span>
<span><span class="co">#&gt; [67] glue_1.7.0                  ChemmineOB_1.41.2          </span></span>
<span><span class="co">#&gt; [69] pkgdown_2.0.7.9000          cowplot_1.1.3              </span></span>
<span><span class="co">#&gt; [71] stringi_1.8.3               gtable_0.3.4               </span></span>
<span><span class="co">#&gt; [73] GenomeInfoDb_1.39.9         GenomicRanges_1.55.4       </span></span>
<span><span class="co">#&gt; [75] munsell_0.5.0               tibble_3.2.1               </span></span>
<span><span class="co">#&gt; [77] pillar_1.9.0                htmltools_0.5.7            </span></span>
<span><span class="co">#&gt; [79] GenomeInfoDbData_1.2.11     R6_2.5.1                   </span></span>
<span><span class="co">#&gt; [81] dbplyr_2.5.0                textshaping_0.3.7          </span></span>
<span><span class="co">#&gt; [83] evaluate_0.23               lattice_0.22-6             </span></span>
<span><span class="co">#&gt; [85] Biobase_2.63.0              highr_0.10                 </span></span>
<span><span class="co">#&gt; [87] memoise_2.0.1               bslib_0.6.1                </span></span>
<span><span class="co">#&gt; [89] Rcpp_1.0.12                 SparseArray_1.3.4          </span></span>
<span><span class="co">#&gt; [91] xfun_0.42                   fs_1.6.3                   </span></span>
<span><span class="co">#&gt; [93] MatrixGenerics_1.15.0       pkgconfig_2.0.3</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gavin Rhys Lloyd, Ralf Johannes Maria Weber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
